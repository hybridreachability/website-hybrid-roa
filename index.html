<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript">google.load("jquery", "1.3.2");</script>

<style type="text/css">
  #bannerimage {
    width: 100%;
    background-image: url("./resources/images/main_banner.png");
    height: 300px;
    background-color: black;
    background-position: center;
    background-size: contain;
    background-repeat: no-repeat;
  }
  img {
    max-width: 100%;
    max-height: 100%;
}

    body {
        font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
        font-weight:300;
        font-size:18px;
        margin-left: auto;
        margin-right: auto;
        width: 1100px;
    }

    h1, h2 {
        font-weight:300;
    }

    .disclaimerbox {
        background-color: #eee;
        border: 1px solid #eeeeee;
        border-radius: 10px ;
        -moz-border-radius: 10px ;
        -webkit-border-radius: 10px ;
        padding: 20px;
    }

    video.header-vid {
        height: 140px;
        border: 1px solid black;
        border-radius: 10px ;
        -moz-border-radius: 10px ;
        -webkit-border-radius: 10px ;
    }

    img.header-img {
        height: 140px;
        border: 1px solid black;
        border-radius: 10px ;
        -moz-border-radius: 10px ;
        -webkit-border-radius: 10px ;
    }

    img.rounded {
        border: 1px solid #eeeeee;
        border-radius: 10px ;
        -moz-border-radius: 10px ;
        -webkit-border-radius: 10px ;
    }

    a:link,a:visited
    {
        color: #1367a7;
        text-decoration: none;
    }
    a:hover {
        color: #208799;
    }

    td.dl-link {
        height: 160px;
        text-align: center;
        font-size: 22px;
    }

    .layered-paper-big { /* modified from: http://css-tricks.com/snippets/css/layered-paper/ */
        box-shadow:
                0px 0px 1px 1px rgba(0,0,0,0.35), /* The top layer shadow */
                5px 5px 0 0px #fff, /* The second layer */
                5px 5px 1px 1px rgba(0,0,0,0.35), /* The second layer shadow */
                10px 10px 0 0px #fff, /* The third layer */
                10px 10px 1px 1px rgba(0,0,0,0.35), /* The third layer shadow */
                15px 15px 0 0px #fff, /* The fourth layer */
                15px 15px 1px 1px rgba(0,0,0,0.35), /* The fourth layer shadow */
                20px 20px 0 0px #fff, /* The fifth layer */
                20px 20px 1px 1px rgba(0,0,0,0.35), /* The fifth layer shadow */
                25px 25px 0 0px #fff, /* The fifth layer */
                25px 25px 1px 1px rgba(0,0,0,0.35); /* The fifth layer shadow */
        margin-left: 10px;
        margin-right: 45px;
    }


    .layered-paper { /* modified from: http://css-tricks.com/snippets/css/layered-paper/ */
        box-shadow:
                0px 0px 1px 1px rgba(0,0,0,0.35), /* The top layer shadow */
                5px 5px 0 0px #fff, /* The second layer */
                5px 5px 1px 1px rgba(0,0,0,0.35), /* The second layer shadow */
                10px 10px 0 0px #fff, /* The third layer */
                10px 10px 1px 1px rgba(0,0,0,0.35); /* The third layer shadow */
        margin-top: 5px;
        margin-left: 10px;
        margin-right: 30px;
        margin-bottom: 5px;
    }

    .vert-cent {
        position: relative;
        top: 50%;
        transform: translateY(-50%);
    }

    hr
    {
        border: 0;
        height: 1.5px;
        background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
    }
</style>

<html>
  <head>
        <title>Computing RoAs for Hybrid Limit Cycles</title>
        <meta property="og:title" content="Factored 3D" />
  </head>

  <body>
    <div id="bannerimage"></div>
    <br>
    <center>
    <span style="font-size:42px">Computation of Regions of Attraction for Hybrid Limit Cycles<br> 
	    Using Reachability: An Application to Walking Robots</span>
    </center>

    <br><br>
      <table align=center width=900px>
       <tr>
        <td align=center width=100px>
        <center>
        <span style="font-size:20px"><a href="https://jay-choi.me/">Jason J. Choi*</a></span>
        </center>
        </td>

        <td align=center width=100px>
        <center>
        <span style="font-size:20px"><a href="https://www.linkedin.com/in/ayushagrawal1/">Ayush Agrawal*</a></span>
        </center>
        </td>

        <td align=center width=100px>
        <center>
        <span style="font-size:20px"><a href="https://hybrid-robotics.berkeley.edu/people/">Koushil Sreenath*</a></span>
        </center>
        </td>	       
	       
        <td align=center width=100px>
        <center>
        <span style="font-size:20px"><a href="https://people.eecs.berkeley.edu/~tomlin/">Claire Tomlin*</a></span>
        </center>
        </td>	       
	       
        <td align=center width=100px>
        <center>
        <span style="font-size:20px"><a href="https://smlbansal.github.io/">Somil Bansal**</a></span>
        </center>
        </td>


     </tr>
    </table>

    <br>
    <table align=center width=700px>
       <tr>
        <td align=center width=100px>
        <center>
        <span>*University of California, Berkeley, **University of Southern California, Los Angeles</span>
        </center>
        </td>	       
      </tr>
    </table>
    <br>
    <center>
      <span style="font-size:20px">RA-L 2022, presented at ICRA 2022</span>
      </center>
    <br>

    <table align=center width=500px>
      <tr>
        <td align=center width=100px><center><span style="font-size:20px">
              <a href="https://arxiv.org/pdf/2201.08538.pdf">[pdf]</a></span>
            </center></td>

            <td align=center width=100px><center><span style="font-size:20px">
              <a href="./resources/bibtex.bib">[bibtex]</a></span>
            </center></td>

            <td align=center width=100px><center><span style="font-size:20px">
              <a href="https://github.com/hybridreachability/HybridRoA">[source code]</a></span>
          </center></td>            
      </tr>
    </table>    

    <br>
  <table align=center>
              <tr>
                  <td width=1000>
                    <center>
                      <iframe width="560" height="315" src="https://www.youtube.com/embed/odl88srx2iI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>                  </center>
                  </td>
              </tr>
            </table>

            <br>

            <br>
          <hr>
    <center><h1>Abstract</h1></center>

            <p align='justify'>Contact-rich robotic systems, such as legged
robots and manipulators, are often represented as hybrid
systems. However, the stability analysis and region-of-attraction
computation for these systems is often challenging because of
the discontinuous state changes upon contact (also referred to as
state resets). In this work, we cast the computation of region-ofattraction
as a Hamilton-Jacobi (HJ) reachability problem. This
enables us to leverage HJ reachability tools that are compatible
with general nonlinear system dynamics, and can formally
deal with state and input constraints as well as bounded
disturbances. Our main contribution is the generalization of
HJ reachability framework to account for the discontinuous
state changes originating from state resets, which has remained
a challenge until now. We apply our approach for computing
region-of-attractions for several underactuated walking robots
and demonstrate that the proposed approach can (a) recover a
bigger region-of-attraction than state-of-the-art approaches, (b)
handle state resets, nonlinear dynamics, external disturbances,
and input constraints, and (c) also provides a stabilizing
controller for the system that can leverage the state resets for
enhancing system stability.</p>
<br>
<br>
<hr>
          <center><h1>Motivation</h1></center>
          <p align='justify'>Many robotic systems are complicated by their <span style="font-weight:bold"> Hybrid System nature due to contacts</span>. In this work, we are interested in attaining stable walking behaviors for legged robots from various configurations. In doing so, it is desirable that the robot leverages contacts with the ground for enhancing its stability.
          </p>          
          <table align=center width=900px>
            <tr>
                <td width=640px>
                  <center>
                      <a href="./resources/images/hybrid_robotic_systems.png"><img src ="./resources/images/hybrid_robotic_systems.png"></img></href></a><br> <!-- ./resources/images/results_simulation.png -->
                </center>
                </td>
              </tr>
              <tr>
            <td width=640px>
              <center>
                  <span style="font-size:14px"><i> <span style="font-weight:bold">Examples of hybrid robotics systems.
                  </span> Hybrid system, roughly speaking is any system that cannot be described by one mode of dynamics. Robots that people are really excited to use for practical applications these days are mostly hybrid systems, due to their nature of interacting with the environment through contacts, impacts or due to many other factors. Examples of such systems include Legged robots, humanoids, aerial vehicles, manipulators with grasping, and multi-robot tasks. (Image sources: Stanford, Kuka, Skydio, UofT, OpenAI, MIT, Boston Dynamics)
</center>
            </td>
            </tr>
        </table>

        <p align='justify'>We aim to achieve this by solving an optimal control problem for the hybrid system models that describe the walking motion of legged robots. The main challenge is that constructive methods for solving this based on the Dynamic Programming are well established for continuous systems, however, are scarcely developed for contact-rich systems.
        </p>

          <br>
          <br>
          <hr>
          <center><h1>Main Idea</h1></center>
          <p align='justify'>First, stabilizing the walking motion is translated into a reachability problem where the target set is the walking gait.          
          </p>
          <table align=center width=900px>
            <tr>
                <td width=640px>
                  <center>
                      <a href="./resources/images/hybrid_roa.svg"><img src ="./resources/images/hybrid_roa.svg"></img></href></a><br> <!-- ./resources/images/results_simulation.png -->
                </center>
                </td>
              </tr>
              <tr>
            <td width=640px>
              <center>
                  <span style="font-size:14px"><i> <span style="font-weight:bold">Examples of hybrid robotics systems.
                  </span> Hybrid system, roughly speaking is any system that cannot be described by one mode of dynamics. Robots that people are really excited to use for practical applications these days are mostly hybrid systems, due to their nature of interacting with the environment through contacts, impacts or due to many other factors. Examples of such systems include Legged robots, humanoids, aerial vehicles, manipulators with grasping, and multi-robot tasks. (Image sources: Stanford, Kuka, Skydio, UofT, OpenAI, MIT, Boston Dynamics)
</center>
            </td>
            </tr>
        </table>
        <p align='justify'>Then, to solve this reachability problem, existing Dynamic Programming reachability frameworks are extended to hybrid systems with discontinuous reset maps by incorporating the <span style="font-weight:bold">Value Remapping principle</span> in the algorithm. The main idea of the value remapping is that the value function at a pre-reset state (those on the switching surface) is same as the value function at the post-reset state. This value remapping is the bellman principle of optimality with respect to the discrete transition of the hybrid dynamics. Finally, the value remapping does not increase the computational complexity to the existing algorithm.                  
        </p>
        <table align=center width=900px>
          <tr>
              <td width=640px>
                <center>
                    <a href="./resources/images/value_remapping.svg"><img src ="./resources/images/value_remapping.svg"></img></href></a><br> <!-- ./resources/images/results_simulation.png -->
              </center>
              </td>
            </tr>
            <tr>
          <td width=640px>
            <center>
                <span style="font-size:14px"><i> <span style="font-weight:bold">Cartoon description of the value remapping principle.
                </span> The plane S indicates switching surface, the set of states where the discrete transition is applied defined by the reset map. For a walking robot, the reset map is defined by the ground impact, and the switching surface captures all the states where the swing foot hits the ground. The plane S+ indicates the image of the reset map. The main idea of the value remapping is that the value function at a pre-reset state (those on the switching surface) is same as the value function at the post-reset state.
</center>
          </td>
          </tr>
      </table>
          <br>
          <hr>
          <br>

          <center><h1>Simulation Results</h1></center>

          <table align=center width=900px>
            <tr>
                <td width=640px>
                  <center>
                      <a href="./resources/images/system_configurations.svg"><img src ="./resources/images/system_configurations.svg"></img></href></a><br> 
                </center>
                </td>
              </tr>
              <tr>
            <td width=640px>
              <center>
                  <span style="font-size:14px"><i> <span style="font-weight:bold"> (a) Rimless wheel system. </span> 
                  <span style="font-size:14px"><i> <span style="font-weight:bold"> (b) Teleporting Dubins car system. </span> The car “teleports” to the other side of the x-axis whenever it hits the x-axis from a positive y-direction.
                    <span style="font-size:14px"><i> <span style="font-weight:bold"> (c) Two-link Compass-gait walker. The pink indicates the stance leg, and the blue indicates the swing leg. </span></center>
            </td>
            </tr>
        </table>
        <br>
        <br>
        <center><h2>Rimless wheel</h2></center>        
        <p align='justify'>The rimless wheel is a popular model of a passivedynamic walker. One of the reasons for its popularity is that
          RoA can be computed analytically for the rimless wheel. Using the SOS programming, we are able to recover only a subset of the RoA. Our approach is able to recover the entire RoA of the system. </p>

  

        <table align=center width=900px>
          <tr>
              <td width=640px>
                <center>
                    <a href="./resources/images/rimless_wheel_brt.png"><img src ="./resources/images/rimless_wheel_brt.png"></img></href></a><br> <!-- ./resources/images/results_simulation.png -->
              </center>
              </td>
            </tr>
            <tr>
          <td width=640px>
            <center>
                <span style="font-size:14px"><i> <span style="font-weight:bold">Regions of Attraction (RoA) for the rimless wheel limit cycle (black):
                </span> 
                (Left) The true RoA is shown in light pink. RoA obtained using SOS programming is shown in purple. (Right) RoA computed using our approach. The proposed approach is able to recover the entire RoA. (Left is reproduced from <a href="https://arxiv.org/pdf/1010.2247.pdf">Manchester et al., Regions of attraction for hybrid limit cycles of walking robots</a>.)</center>
          </td>
          </tr>
      </table>
      <br>
      <br>
        <center><h2>Teleporting Dubins Car</h2></center>
        <p align='justify'>
          We introduce state resets to a well-known Dubins car system which makes the car “teleport”. The key principles of our method are well exposed in its design and results. Whenever the car hits the x-axis, it will reset to the other side of the state space. The reference periodic orbit is a semicircular trajectory centered at the origin rotating in the counter-clockwise direction. The reset map has the contraction property, so it will be desirable to exploit this reset or "teleport" to reach the target faster.
        </p>
        <p align='justify'>We can first compute the Regions of Attraction (RoA) of the orbit, by computing the reachability value function backward in time based on our numerical algorithm.</p>
        <table align=center width=900px>
          <tr>
              <td width=900px>
                <center>
                    <a href="./resources/images/dubins_car_brt_evolution.gif"><img src ="./resources/images/dubins_car_brt_evolution.gif"></img></href></a><br> 
              </center>
              </td>
            </tr>
            <tr>
          <td width=900px>
            <center>
                <span style="font-size:14px"><i> <span style="font-weight:bold">Regions of Attraction (RoA) for the Teleporting Dubins Car: </span> Our algorithm verifies the RoA of the orbit (in blue) by solving the dynamic programming backward in time. Thus, the verified RoA gradually expands from the orbit as we run our algorithm. Note that a big portion of the region near the switching surface (x-axis) is captured in the RoA, since the "teleport" is more accessible to the states in this region.
                </center>
          </td>
          </tr>
      </table>

      <p align='justify'> Then, for an initial state that is included in the computed RoA, when we evaluate the optimal controller resulting from the computed value function, the trajectory is able to reach the orbit in the most time-optimal way. 
      </p>

      <table align=center width=900px>
        <tr>
            <td width=900px>
              <center>
                  <a href="./resources/images/Dubins_car_opt_ctrl_with_arrows.gif"><img src ="./resources/images/Dubins_car_opt_ctrl_with_arrows.gif"></img></href></a><br> 
            </center>
            </td>
          </tr>
          <tr>
        <td width=900px>
          <center>
              <span style="font-size:14px"><i> <span style="font-weight:bold">The optimal trajectory computed from our method reaches the target set after 4.3s by exploiting the teleport twice.</span> 
              </center>
        </td>
        </tr>
    </table>

    <p align='justify'> In contrast, a baseline controller designed based on feedback linearization takes significantly longer time to reach the orbit, since it does not have the knowledge of how to utilize the teleport.
    </p>

    <table align=center width=900px>
      <tr>
          <td width=900px>
            <center>
                <a href="./resources/images/Dubins_car_feedback_linearization.gif"><img src ="./resources/images/Dubins_car_feedback_linearization.gif"></img></href></a><br> 
          </center>
          </td>
        </tr>
        <tr>
      <td width=900px>
        <center>
            <span style="font-size:14px"><i> <span style="font-weight:bold">The feedback-linearization-based controller reaches the target set after 11.9s. It does not know how to exploit the reset map.</span> 
            </center>
      </td>
      </tr>
  </table>
  <br>
  <br>
  <center><h2>Two-link Compass-gait Walker</h2></center>
  <p align='justify'> We next consider a compass-gait walker, which consists of two links with an actuated joint between them. We consider a hybrid model of walking, with alternating phases of a continuous-time singlesupport phase followed by an instantaneous inelastic impact of the swing leg with the ground. The switching surface is defined as the set of states where the swing foot strikes the ground with a negative velocity.
  </p>

  <p align='justify'> The target hybrid limit cycle we wish to stabilize to is designed as a reference walking gait, which is tracked by a baseline controller designed based on feedback linearization and Control Lyapunov Function-based Quardartic Program (CLF-QP).
  </p>  

  <table align=center width=900px>
    <tr>
        <td width=900px>
          <center>
              <a href="./resources/images/sim_and_phase_reference_gait.gif"><img src ="./resources/images/sim_and_phase_reference_gait.gif"></img></href></a><br> 
        </center>
        </td>
      </tr>
      <tr>
    <td width=900px>
      <center>
          <span style="font-size:14px"><i> <span style="font-weight:bold">The robot in the nominal walking motion under the CLF-QP baseline controller. Left is the corresponding phase portrait in the configuration space.</span> 
          </center>
    </td>
    </tr>
</table>

<p align='justify'> Now let’s say someone pushed the robot hard so it shifted to this new initial state that is quite far from the usual walking motion. On the perturbed initial state, The robot has a big momentum to the backward direction. If we apply the same baseline controller from this state, it fails to stabilize to the walking gait.
</p>  

<table align=center width=900px>
  <tr>
      <td width=900px>
        <center>
            <a href="./resources/images/sim_and_phase_case1_clf_qp.gif"><img src ="./resources/images/sim_and_phase_case1_clf_qp.gif"></img></href></a><br> 
      </center>
      </td>
    </tr>
    <tr>
  <td width=900px>
    <center>
        <span style="font-size:14px"><i> <span style="font-weight:bold">The baseline controller failing to stabilize back to the walking motion from a largely perturbed initial state.</span>
        </center>
  </td>
  </tr>
</table>

<p align='justify'> If we apply the optimal controller computed from our method to the same initial state, the robot is able to successfully stabilize back to the walking gait. Notice that it steps on the ground first, and exploit the ground impact to absorb the adverse momentum to stabilize the robot more easily.
</p>  

<table align=center width=900px>
  <tr>
      <td width=900px>
        <center>
            <a href="./resources/images/sim_and_phase_case1_opt_ctrl.gif"><img src ="./resources/images/sim_and_phase_case1_opt_ctrl.gif"></img></href></a><br> 
      </center>
      </td>
    </tr>
    <tr>
  <td width=900px>
    <center>
        <span style="font-size:14px"><i> <span style="font-weight:bold">The optimal controller recovering to the gait from the same perturbation.
        </span>
        </center>
  </td>
  </tr>
</table>

<p align='justify'> Finally, we can also visualize the Region of Attractions verified from our method. First, we apply our method to the closed loop dynamics of the baseline controller. Although it is designed to be locally stabilizing, the verified RoA comprises only a small neighborhood of the reference gait. By contrast, exploiting the full control capacity limited by the torque saturation and the reset map, we are able to verify that the actual stabilizable region is much bigger than what can be achieved by the CLF-QP controller. Finally, we can also introduce disturbance to the robot’s dynamics: an unmodeled repulsive or stiction torque applied to the joint between the leg. The RoA computed under the robust optimal control setting is visualized next. Since now we only verify states that are robustly stabilizable to the gait, the resulting RoA is smaller than the non-robust RoA. However, it still shows that by applying the robust optimal controller, it is able to robustly stabilize a larger set of states than the CLF-QP.
</p> 

<table align=center width=900px>
  <tr>
      <td width=640px>
        <center>
            <a href="./resources/images/compass_gait_brt_comparison.jpg"><img src ="./resources/images/compass_gait_brt_comparison.jpg"></img></href></a><br> 
      </center>
      </td>
    </tr>
    <tr>
  <td width=640px>
    <center>
        <span style="font-size:14px"><i> <span style="font-weight:bold">RoAs for the compass-gait walker visualized by their projection on the configuraion space.
        </span> (a) RoA for the closed-loop dynamics under the CLF-QP controller. (b) RoA that is verified by allowing the full control capacity. (c) Robust RoA by introducing the disturbance to the dynamics. 
        </center>
  </td>
  </tr>
</table>

<!-- <table align=center width=900px>
            <tr>
                <td width=640px>
                  <video width="640" height="360" controls>
                    <source src="./resources/multimedia/dubins_car_optimal_control.mp4" type="video/mp4">
                  Teleporting Dubins Car under optimal control
                  </video>
                </td>
            </tr>
                <td width=640px>
                  <center>
                      <span style="font-size:14px"><i> <span style="font-weight:bold">Regions of Attraction (RoA) for the rimless wheel limit cycle (black):
                      </span> 
                      (Left) The true RoA is shown in light pink. RoA obtained using SOS programming is shown in purple. (Right) RoA computed using our approach. The proposed approach is able to recover the entire RoA. (Left is reproduced from [Manchester et al., Regions of attraction for hybrid limit cycles of walking robots](https://arxiv.org/pdf/1010.2247.pdf).)</center>
                </td>
            </tr>
        </table> -->

          <!-- <center> -->
          <!-- <p align='justify'> We test the proposed approach in hardware using a TurtleBot 2 with a mounted stereo RGB camera. For planning, we use a state-of-the-art neural-network-based planner that uses the current RGB image to determine a candidate next state. We ran the experiment with and without the safety controller and show corresponding videos below. Without the safety controller, the learning-based planner struggles with making sharp turns near the corner, and eventually collides into the obstacle (the chair, in this case). However, when the learning-based planner is used within the proposed safety framework, the safety controller is able to account for this unsafe situation and safely steer the vehicle away from the obstacle.
            </p> -->
          <!-- </center> -->
          <br>
          <!--<table align=center width=1000px>
              <tr>
                  <td width=800px>
                    <center>
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/DvS7fnTIQ8w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><br>
                  </center>
                  </td>
              </tr>
                  <td width=800px>
                    <center>
                        <span style="font-size:14px"><i> <span style="font-weight:bold">Experiment 1: No safety.</span> When the learning-based planner is deployed, it makes goal-directed decisions but does not guaruntee that these decisions will not result in collisions. Here we see one such scenario.</i>
                        <br><br><br>
                  </center>
                  </td>
              </tr>
          </table>-->


           <hr>

            <table align=center width=1100px>
                <tr>
                    <td>
                      <left>
                <center><h1>Acknowledgements</h1></center>
                This research is supported in part by  National Science Foundation Grants CMMI-1931853, CMMI-1944722, NASA under the University Leadership Initiative (<a href="https://sites.google.com/view/nasa-safe-aviation-autonomy/home">\#80NSSC20M0163</a>), and the DARPA Assured Autonomy Program. The work of Jason Choi received the support of a fellowship from Kwanjeong Educational Foundation, Korea.
                <br>
                <br>
                This webpage template was borrowed from some <a href="https://richzhang.github.io/colorization/">colorful folks</a>.
            </left>
        </td>
        </tr>
        </table>

        <br><br>
</body>
</html>
